---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime());

function formatDate(str: string) {
  return new Date(str).toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' });
}
---
<BaseLayout title="Writing â€” Amey Bhavsar" active="writing">
  <div class="blog-page">
    <div class="blog-page-header">
      <div class="section-eyebrow">Writing</div>
      <h1 style="font-family:'Space Grotesk',sans-serif; font-size:clamp(2.5rem,5vw,3.5rem); font-weight:700; letter-spacing:-0.04em; color:var(--z-950); line-height:1.1;">From the<br>notebook.</h1>
    </div>
    <div class="blog-list">
      {posts.map((post, index) => {
        const tagList = post.data.tags?.split(',').map((t: string) => t.trim()) ?? [];
        return (
          <a href={`/blog/${post.slug}`} class="writing-item stagger-reveal" style={`--stagger-index: ${index}`}>
            <div>
              <div class="writing-date">{formatDate(post.data.publishedAt)}</div>
              <div class="writing-title">{post.data.title}</div>
              {post.data.summary && <div class="writing-excerpt">{post.data.summary}</div>}
            </div>
            <div style="display:flex; flex-direction:column; align-items:flex-end; gap:0.5rem; flex-shrink:0;">
              {tagList.slice(0,2).map((tag: string) => (
                <span class="writing-tag">{tag}</span>
              ))}
            </div>
          </a>
        );
      })}
    </div>
  </div>
</BaseLayout>
